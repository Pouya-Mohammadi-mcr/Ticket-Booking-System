<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <title>Checkout</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{/css/styleForCheckout.css}">
    <link rel="stylesheet" th:href="@{/css/infoButtonsStyle.css}">
    
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <script type="text/javascript">
        function goBack() {
            window.history.back();
        }

        function addToPrice() {
            const radio_class = document.getElementsByName('radio_class');
            const radio_insurance = document.getElementsByName('insurance');
            const radio_age = document.getElementsByName('radio_age');
            const quantity = document.getElementById('quantity').value;
            const thePrice = document.getElementById("hiddenPrice").innerHTML;
            var add = "0";
            var percent = 0;
            for (var i = 0, lengthC = radio_class.length; i < lengthC; i++) {
                // alert("Hello");
                if (radio_class[i].checked){
                    if(radio_class[i].value === "first"){
                        add = +add + 50;
                    }
                    if(radio_class[i].value === "business"){
                        add = +add + 20;
                    }

                    break;
                }
            }
            for (var j = 0, lengthR = radio_insurance.length; j < lengthR; j++) {
                // alert("Hello");
                if (radio_insurance[j].checked){
                    if(radio_insurance[j].value === "yes"){
                        add = +add + 20;
                    }

                    break;
                }
            }
            for (var k = 0, lengthA = radio_age.length; k < lengthA; k++) {
                // alert("Hello");
                if (radio_age[k].checked){
                    if(radio_age[k].value === "child"){
                        percent = 20/100;
                    }

                    break;
                }
            }
            document.getElementById("finalPrice").value = (Math.round((+add - +thePrice*percent + +thePrice + +quantity*20 + Number.EPSILON) * 100) / 100).toString();
            document.getElementById("price").innerHTML =  (Math.round((+add - +thePrice*percent + +thePrice + +quantity*20 + Number.EPSILON) * 100) / 100).toString();
        }
    </script>

</head>
<body >

<h1>Ticket Builder</h1>
<div class="row">
    <div class="col-50">
        <div class="container">
            <button type="button"  class="btn" onclick="goBack()" id="return">Go Back</button>
            <form id="extraInfo"  action="#" th:action="@{/setTicketInformation}"  method="post">
                <h3>Make Your Ticket</h3>
                <div class="row" >
                    <div class="col-50">
                        <label> <i class="fa fa-user"></i> Class</label>
                        <ul>
                            <input type="radio" id="first" name="radio_class" value="first"  onclick="addToPrice()"> First Class
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>First Class</h3>
                                    <p>Extra £50</p>
                                </div>
                            </li>
                            <input type="radio" id="business" name="radio_class" value="business"  onclick="addToPrice()"> Business Class
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Business Class</h3>
                                    <p>Extra £20</p>
                                </div>
                            </li>
                            <input type="radio" id="economy" name="radio_class"  value="economy"  onclick="addToPrice()" checked="checked"> Economy Class
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Economy Class</h3>
                                    <p>No extra cost - base ticket</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <hr>
                <div class="row" >
                    <div class="col-50">
                        <label> <i class="fa fa-user"></i> Age Group</label>
                        <ul>
                            <input type="radio" id="adult" name="radio_age" value="adult"  onclick="addToPrice()" checked="checked"> Adult
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Adult</h3>
                                    <p>16+ years</p>
                                </div>
                            </li>
                            <input type="radio" id="child" name="radio_age" value="child"  onclick="addToPrice()"> Child
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Child</h3>
                                    <p>0-15 years (Your ticket will cost 20% less)</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-50">
                        <ul>
                            <label ><i class="fa fa-life-ring"></i> Flight Insurance</label>
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Flight Insurance</h3>
                                    <p> Extra £20</p>
                                </div>
                            </li>
                        </ul>
                        <input type="checkbox" id="insurance" name="insurance"  value="yes" onclick="addToPrice()"> Add
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-50">
                        <ul>
                            <label><i class="fa fa-cutlery"></i> Meal </label>
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Meal</h3>
                                    <p>No extra cost - Choose your preferred meal</p>
                                </div>
                            </li>
                        </ul>
                        <input type="radio" id="omnivore" name="meal"  value="omnivore" checked="checked" > Omnivore
                        <input type="radio" id="vegetarian" name="meal"  value="vegetarian" > Vegetarian
                        <input type="radio" id="vegan" name="meal"  value="vegan" > Vegan
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-50">
                        <ul>
                            <label for="quantity"><i class="fa fa-suitcase"></i> Extra Luggage</label>
                            <li><i class="fa fa-info-circle"></i>
                                <div class="content">
                                    <h3>Extra Luggage</h3>
                                    <p>For every extra luggage +£20</p>
                                </div>
                            </li>
                        </ul>
                        <input type="number" id="quantity" name="luggage" value="0" onchange="addToPrice()"  min="0" max="5" >
                    </div>
                    <div hidden class="col-50">
                        <input id="finalPrice" name="finalPrice" value="">
                    </div>
                    <button class="btn btn-primary" id="btn-ticket" type="submit">Add Ticket</button>
                </div>
            </form>
        </div>
    </div>
    <div class="col-25">
        <div class="container">
            <h4>Your Flight<span class="price" style="color:black" th:text=" 'ID: '+${flight.id}" th:value="${flight.id}" id="flightId">ID: </span> <i class="fa fa-plane"></i></h4>
            <hr>
            <p>From: <b th:text="${flight.from}" ></b></p>
            <p>To: <b th:text="${flight.to}"></b></p>
            <p>Date: <b th:text="${flight.date}"></b> </p>
            <p>Departure:
                <b th:if="*{flight.departureTime!=null and flight.departureTime=='NA'}" th:text="${flight.departureTime}"></b>
                <b th:if="*{flight.departureTime!=null and #strings.length(flight.departureTime)==4 and flight.departureTime!='NA'}" th:text="${#strings.substring(flight.departureTime,0,2)} + ':'+${#strings.substring(flight.departureTime,2,4)}"></b>
                <b th:if="*{flight.departureTime!=null and #strings.length(flight.departureTime)==3 and flight.departureTime!='NA'}" th:text="${#strings.substring(flight.departureTime,0,1)} + ':'+${#strings.substring(flight.departureTime,1,3)}"></b>
                <b th:if="*{flight.departureTime!=null and #strings.length(flight.departureTime)<3 and flight.departureTime!='NA'}" th:text="${flight.departureTime}+':00'"></b>
            </p>
            <p>Arrival:
                <b th:if="*{flight.arrivalTime!=null and flight.arrivalTime=='NA'}" th:text="${flight.arrivalTime}"></b>
                <b th:if="*{flight.arrivalTime!=null and #strings.length(flight.arrivalTime)==4 and flight.arrivalTime!='NA'}" th:text="${#strings.substring(flight.arrivalTime,0,2)} + ':'+${#strings.substring(flight.arrivalTime,2,4)}"></b>
                <b th:if="*{flight.arrivalTime!=null and #strings.length(flight.arrivalTime)==3 and flight.arrivalTime!='NA'}" th:text="${#strings.substring(flight.arrivalTime,0,1)} + ':'+${#strings.substring(flight.arrivalTime,1,3)}"></b>
                <b th:if="*{flight.arrivalTime!=null and #strings.length(flight.arrivalTime)<3 and flight.arrivalTime!='NA'}" th:text="${flight.arrivalTime}+':00'"></b>
            </p>
            <hr>
            <p>
                Total
                <span  class="price" style="color:black">
                    £<b id="price" th:text=" ${flight.price} "></b>
                </span>
            </p>
            <p hidden>
                Total
                <span  class="price" style="color:black">
                    £<b id="hiddenPrice" th:text=" ${flight.price} "></b>
                </span>
            </p>
        </div>
    </div>
</div>
<button class="btn btn-primary" style="float: right" id="btn-pay" onclick="document.getElementById('extraInfo').submit();" type="submit">Pay</button>


</body>
</html>

